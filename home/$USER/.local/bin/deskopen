#!/bin/bash
# /etc/bash_completion.d/deskopen

usage() {
  echo "Usage: $0 [-s] [-S] [-h] [FILE]"
  echo "  -s shortest Use shortest names"
  echo "  -S short    Use short names"
  echo "  -h help     Print this help message"
  echo
  exit 1
}

bad_args() {
  usage
}

foo() {
  gio launch $1
}

APP=${@: -1}
DIR=/var/lib/flatpak/exports/share/applications
LIST=$( ls $DIR )
SHORT=false

while getopts "sSh" opt; do
  case $opt in
    s|S)
      SHORT=true
      ;;
    h)
      usage
      ;;
    ?)
      usage
      ;;
  esac
done


if [[ $SHORT = true ]]; then
  if (( $# != 2 )); then
    bad_args
  fi

  if [[ "$1" == "-S" ]]; then
    APP=$2".desktop"
  fi

  if [[ "$1" == "-s" ]]; then
    case $APP in
      firefox)
        APP="org.mozilla.firefox.desktop"
      ;;
      telegram)
        APP="org.telegram.desktop.desktop"
      ;;
      code)
        APP="com.visualstudio.code.desktop"
      ;;
      *)
        echo "Unknown: $APP"
      ;;
    esac
  fi

else
  if (( $# != 1 )); then
    bad_args
  fi
fi

echo DIR = $DIR
echo APP = $APP
echo PATH = $DIR/$APP
echo LIST = $LIST

foo $DIR/$APP
